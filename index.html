<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>SCHEDA PAZIENTE TI</title>
<style>
body { font-family: 'Segoe UI', Roboto, Arial, sans-serif; margin:0; padding:16px; background:#f0f2f5; }
.container { max-width: 950px; margin:0 auto; background:#fff; padding:24px; border-radius:12px; box-shadow:0 6px 16px rgba(0,0,0,0.1); position:relative; min-height:calc(100vh - 40px); }
header { display:flex; align-items:center; gap:16px; margin-bottom:16px; }
header img { height:60px; width:auto; }
header h1 { font-size:24px; text-align:center; flex:1; margin:0; }
form { display:grid; grid-template-columns:repeat(2,1fr); gap:16px; }
label { display:block; font-size:14px; margin-bottom:4px; font-weight:500; }
input, select, textarea { width:100%; padding:8px 10px; border-radius:6px; border:1px solid #ccc; font-size:14px; box-sizing:border-box; }
textarea { min-height:60px; }
.full { grid-column:1/3; }
.section-title { grid-column:1/3; font-size:18px; margin-top:16px; margin-bottom:8px; color:#555; border-bottom:1px solid #ccc; padding-bottom:4px; font-weight:bold; }
.buttons { grid-column:1/3; display:flex; gap:12px; margin-top:16px; flex-wrap:wrap; }
button { padding:10px 16px; font-size:14px; border:none; border-radius:6px; cursor:pointer; background:#4f46e5; color:#fff; transition:0.2s; }
button:hover { background:#3730a3; }
table { width:100%; border-collapse:collapse; margin-top:20px; font-size:13px; }
th, td { border:1px solid #ddd; padding:8px; text-align:left; }
th { background:#f3f4f6; }
tr:hover { background:#f1f5f9; }
@media(max-width:760px){ form { grid-template-columns:1fr; } .full { grid-column:auto; } header { flex-direction:column; align-items:flex-start; } header h1 { text-align:left; } }

#loginDiv { max-width:400px; margin:50px auto; padding:20px; background:#fff; border-radius:10px; box-shadow:0 6px 16px rgba(0,0,0,0.1); text-align:center; }
#loginDiv input { margin-bottom:10px; width:90%; }
#logoutBtn { position:absolute; right:24px; top:24px; padding:8px 12px; background:#4f46e5; color:#fff; border:none; border-radius:6px; cursor:pointer; }
#logoutBtn:hover { background:#3730a3; }
footer { text-align:center; margin-top:20px; font-size:12px; color:#555; }
header img.logo { display:block; margin:0 auto; }
</style>
</head>
<body>

<!-- Login -->
<div id="loginDiv">
  <img src="https://r2.fivemanage.com/qTNmb8WLSLzz3wAA8WJPV/308508198_176374684914619_6711714230399794652_n.jpg" alt="Logo" class="logo" style="height:80px; margin-bottom:10px;">
  <h2>Benvenuto nel sistema di registrazione schede TI</h2>
  <p>Effettua l'accesso con le credenziali che ti sono state affidate</p>
  <input type="email" id="loginEmail" placeholder="Email"><br>
  <input type="password" id="loginPassword" placeholder="Password"><br>
  <button onclick="login()">Accedi</button>
  <footer>© Vitrio, Tutti i diritti riservati</footer>
</div>

<!-- App principale -->
<div class="container" id="mainApp" style="display:none;">
  <button id="logoutBtn" onclick="logout()">Logout</button>
  <header>
    <img src="https://r2.fivemanage.com/qTNmb8WLSLzz3wAA8WJPV/308508198_176374684914619_6711714230399794652_n.jpg" alt="Logo">
    <h1>Scheda Paziente TI</h1>
  </header>

  <div class="section-title">Info paziente</div>
  <form id="mainForm" onsubmit="event.preventDefault(); saveEntry();">
    <!-- FORM FIELDS (come prima) -->
    <div><label>Missione numero<input id="missione" required></label></div>
    <div><label>Data<input type="date" id="data" required></label></div>
    <div><label>Nome e Cognome<input id="nome"></label></div>
    <div><label>Età<input type="number" id="eta" min="0" step="1"></label></div>
    <div><label>Data di nascita<input type="date" id="dob"></label></div>
    <div><label>Corporatura<input type="number" id="corporatura" min="0" step="1"></label></div>
    <div class="full"><label>Patologia<textarea id="patologia"></textarea></label></div>
    <div class="full"><label>Motivo trasporto<textarea id="motivo"></textarea></label></div>
    <div><label>Prelevare da<input id="prelevare"></label></div>
    <div><label>Portare a<input id="portare"></label></div>
    <div><label>PDC<input id="pdc"></label></div>
    <div><label>Telefono PDC<input id="tel" type="tel" inputmode="numeric" pattern="[0-9]*"></label></div>

    <div class="section-title">Team</div>
    <div><label>Autista Soccorritore<input id="autista"></label></div>
    <div><label>1° Soccorritore<input id="socc1"></label></div>
    <div><label>2° Soccorritore<input id="socc2"></label></div>
    <div><label>3° Soccorritore<input id="socc3"></label></div>
    <div><label>Tirocinante<input id="tiro"></label></div>

    <div class="section-title">Info trasporto</div>
    <div><label>Arrivo in sede<input type="time" id="arrivoSede"></label></div>
    <div><label>Arrivo dal paziente<input type="time" id="arrivoPaz"></label></div>
    <div><label>Arrivo a destinazione<input type="time" id="arrivoDest"></label></div>
    <div>
      <label>Mezzo assegnato
        <select id="mezzo">
          <option value="">-- Seleziona un mezzo --</option>
          <option>ABZ 205</option><option>ABZ 406</option><option>ABZ 551</option>
          <option>ABZ 237</option><option>ABZ 788</option><option>ABZ 689</option>
          <option>DOBLO' 006</option><option>PUNTO BIANCA 428</option><option>PUNTO BLU 159</option>
        </select>
      </label>
    </div>
    <div><label>Prezzo<input type="text" id="prezzo"></label></div>
    <div class="full"><label>Presidi necessari<textarea id="presidi"></textarea></label></div>
    <div class="full"><label>Note<textarea id="note"></textarea></label></div>
    <div class="full" style="display:flex;gap:16px;flex-wrap:wrap">
      <div style="flex:1">
        <label>Firma referente (nome e cognome)</label>
        <input id="firmaRef" placeholder="">
      </div>
    </div>
    <div><label>Stato trasporto
      <select id="stato">
        <option value="">-- Seleziona Stato --</option>
        <option>Confermato</option>
        <option>In lavorazione</option>
        <option>Annullato</option>
      </select>
    </label></div>

    <div class="buttons">
      <button type="submit">Salva scheda TI</button>
      <button type="button" onclick="resetForm()">Pulisci scheda TI</button>
      <button type="button" onclick="exportPDF()">Esporta PDF</button>
    </div>
  </form>

  <div id="pdfArea">
    <h2>Elenco schede TI</h2>
    <table id="dataTable">
      <thead>
        <tr><th>Missione N°</th><th>Data</th><th>Stato</th><th>Azioni</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
  <footer>© Vitrio, Tutti i diritti riservati</footer>
</div>

<!-- Firebase e script JS (inclusi PDF) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script>
// CONFIG FIREBASE
const firebaseConfig = {
  apiKey: "TUO_API_KEY",
  authDomain: "TUO_PROJECT_ID.firebaseapp.com",
  projectId: "TUO_PROJECT_ID",
  storageBucket: "TUO_PROJECT_ID.appspot.com",
  messagingSenderId: "TUO_SENDER_ID",
  appId: "TUO_APP_ID"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const auth = firebase.auth();

let entries = [];
let editingId=null;

// LOGIN / LOGOUT
function login(){
  const email=document.getElementById('loginEmail').value;
  const password=document.getElementById('loginPassword').value;
  auth.signInWithEmailAndPassword(email,password)
    .then(()=>{ document.getElementById('loginDiv').style.display='none'; document.getElementById('mainApp').style.display='block'; loadEntriesFromDB(); })
    .catch(err=>alert(err.message));
}
function logout(){ auth.signOut().then(()=>{ document.getElementById('loginDiv').style.display='block'; document.getElementById('mainApp').style.display='none'; }); }

// Realtime listener
auth.onAuthStateChanged(user=>{
  if(user){ document.getElementById('loginDiv').style.display='none'; document.getElementById('mainApp').style.display='block'; loadEntriesFromDB(); }
  else{ document.getElementById('loginDiv').style.display='block'; document.getElementById('mainApp').style.display='none'; }
});

// ... Qui vanno tutti gli script precedenti per gestione form, saveEntry, resetForm, exportSinglePDF, ecc. 
// Stessa logica già scritta prima, con save/load da Firestore e PDF che mostra stato e firma
</script>
</body>
</html>
